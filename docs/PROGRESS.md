# 项目阶段进度记录

## 阶段 1：原始数据采集与基础 API（已完成）
- 时间：当前提交之前
- 内容：
  - FastAPI + SQLite 架构搭建，核心配置、日志、路由完成。
  - 集成 Hyperliquid API，同步账本、成交、持仓、订单、权益曲线等数据，带时间游标与去重。
  - 建立任务队列（RQ）与同步接口（同步/异步）。
  - 构建基础查询接口（游标、最新记录、分页/导出）以及简单评分计算。
- 状态：可作为后续功能（钱包管理、前台展示）的数据底座。  

## 阶段 2：钱包管理 & 查询 API（本次完成）
- 内容：
  - 新增 `wallets` 表，导入接口落库并支持标签、来源字段。
  - 增补列表、详情、概览接口，可分页筛选状态/标签/搜索，并关联最新指标/评分。
  - 同步任务更新钱包状态与最近同步时间。
- 状态：API 端可提供钱包级数据给前台使用，同时保留指标结果。

## 阶段 3：前端仪表盘与钱包页面（本次完成）
- 内容：
  - 采用 React + Vite + React Query + Recharts 构建前端工程，统一暗色主题。
  - 实现仪表盘、钱包列表、钱包详情页面，支持分页、过滤、图表展示与导出按钮。
  - 封装 API 客户端与 Query Provider，使用 `.env` 配置后端地址。
- 状态：基础前台可展示核心数据，后续可继续扩展榜单、AI 分析等模块。

## 阶段 4：RBAC / 系统配置 / 审计日志（本次完成）
- 内容：
  - 建立用户、角色、权限、审计日志、系统配置等数据模型，支持两级映射。
  - 实现密码哈希、2FA 标记、角色权限管理、系统配置增删改、审计日志记录。
  - 提供 `/api/admin/*` 管理接口，统一通过 `X-Admin-Token` 验证；操作自动记录审计日志。
- 状态：后台可进行安全的用户/权限管理与系统参数配置，为后续模块（任务、通知、榜单）提供权限体系基础。

## 阶段 5：标签 / 榜单 / AI 建议（本次完成）
- 内容：
  - 实现三层标签体系（Tag + WalletTag），提供列表、创建、钱包打标 API，与钱包列表/详情联动展示。
  - 构建榜单模型与服务，可定义规则、执行排名、存储历史快照，并暴露列表/详情/手动刷新接口；前端新增榜单页。
  - 引入 AI 分析模块（AIAnalysis），基于指标生成风格/优势/风险/建议等文本，并在钱包详情页展示与触发。
- 状态：系统具备基础的标签管理、榜单展示与 AI 建议能力，支持筛选与评估优秀钱包。

## 阶段 6：通知 / 任务监控 / 运营报表（本次完成）
- 内容：
  - 建模 `TaskRecord`、通知模板/订阅/历史，并在同步任务中写入执行日志；提供任务列表、状态统计等接口。
  - 新增通知模板/订阅/发送 API，与操作审计一致受 `X-Admin-Token` 保护。
  - 提供 `/reports/operations` 运营报表、前端运营监控页面（含管理员 Token 录入），可查看任务运行、通知发送等指标。
  - API / 前端默认通过环境变量自定义域名，避免固定访问地址。
- 状态：基础通知与运维监控能力已具备，后续可扩展到真实邮件/推送渠道与更复杂任务队列。

## 阶段 7：自动调度与持续运营（本次完成）
- 内容：
  - 引入 APScheduler，基于 `schedule_jobs` 表动态创建定时任务（刷新榜单、同步钱包等），在 FastAPI 启动时自动加载。
  - 增加调度管理 API/前端入口，可创建 Cron 任务；运营页支持录入管理员 Token 后进行调度配置。
  - 故障通知与榜单 Top 变更通知：任务失败会触发通知模板，榜单刷新检测 Top 变更并按配置发送邮件/Webhook。
- 状态：系统已具备自动运行和异常告警能力，可持续输出榜单/数据并通知运营。

## 阶段 A：钱包管理增强（本次完成）
- 内容：
  - 钱包批量导入：修复 500 报错、自动补建导入日志表，保留导入人/时间/标签；新增 `/wallets/import/history` 接口与前端历史面板。
  - 列表能力升级：支持周期切换（1D/30D/365D/全部）、服务端排序（胜率/收益率/收益额/交易次数/回撤等），并在 UI 上提供排序方向与周期按钮。
  - 体验优化：钱包地址一键复制（列表/详情）、标签按颜色渲染、钱包导入文本框全宽展示，导入结果展示提交人/标签。
- 状态：钱包模块的导入-查看-筛选链路闭环，满足后续评分/AI/榜单的可视化入口需求。

## 阶段 5：处理策略与批次调度（进行中）
- 内容规划：
  - 在处理配置中新增“处理范围”（全部 / 今日导入 / 最近 7 天 / 指定标签）与“重算间隔”字段，队列根据设置自动挑选钱包；在运营面板展示当前策略并支持一键切换。
  - 实现批次调度与速率限制：后台配置“每批钱包数、批次间隔、令牌桶速率”，worker 依此排队并控制 Hyperliquid API 调用频率，避免 429。
  - 钱包优先级：同步/评分后生成 A/B/C 级别，高优先级钱包 `next_score_due` 缩短，普通钱包延长，并支持按标签批量触发。
  - 新接口 `POST /processing/run_batch` 允许按时间/标签手动投递，并在导入结果、运营面板等处显示实时进度条和预计完成时间。
- 状态：设计方案已确认，即将进入开发阶段。
